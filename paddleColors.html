<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Paddle Colors - apaPong</title>
    <link rel="stylesheet" href="css/paddleColors.css">
</head>
<body>
    <div class="container">
        <h1 class="paddle-colors-title">Choose Paddle Colors</h1>
        
        <div class="paddle-colors-content">
            <!-- Left Player Section -->
            <div class="player-section left-section">
                <h2 class="player-name" id="leftPlayerName">Left Player</h2>
                <div class="color-grid" id="leftColorGrid">
                    <!-- Colors will be generated by JavaScript -->
                </div>
            </div>
            
            <!-- Divider -->
            <div class="divider"></div>
            
            <!-- Right Player Section -->
            <div class="player-section right-section">
                <h2 class="player-name" id="rightPlayerName">Right Player</h2>
                <div class="color-grid" id="rightColorGrid">
                    <!-- Colors will be generated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="game-mode-section">
            <h2 class="game-mode-title">Game Mode</h2>
            <div class="game-mode-options" id="gameModeOptions">
                <!-- Game mode buttons will be generated by JavaScript -->
            </div>
        </div>
        
        <button class="start-game-button pixel-button" id="startGameBtn">Start Game</button>
        <a href="playerNames.html" class="back-button pixel-button">Back</a>
    </div>
    
    <script>
        // Color options
        const colors = [
            { name: "Blue", color: [100, 200, 255] },
            { name: "Red", color: [255, 100, 100] },
            { name: "Green", color: [100, 255, 100] },
            { name: "Yellow", color: [255, 255, 100] },
            { name: "Purple", color: [200, 100, 255] },
            { name: "Orange", color: [255, 150, 50] },
        ];
        
        // Default colors
        const DEFAULT_LEFT_PADDLE_COLOR = [100, 200, 255];
        const DEFAULT_RIGHT_PADDLE_COLOR = [255, 100, 100];
        
        // Game mode constants
        const GAME_MODE = {
            FIXED_SCORE: 'fixed_score',
            LEAD_BY_THREE: 'lead_by_three',
            DEFAULT: 'fixed_score',
        };
        
        // Game mode options
        const gameModes = [
            { 
                id: GAME_MODE.FIXED_SCORE, 
                name: 'First to 5 Points',
                description: 'Win by reaching 5 points first'
            },
            { 
                id: GAME_MODE.LEAD_BY_THREE, 
                name: 'Lead by 3 Points',
                description: 'Win by leading with 3 points'
            },
        ];
        
        // Get current game mode from localStorage or default
        function getCurrentGameMode() {
            const saved = localStorage.getItem('gameMode');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    return GAME_MODE.DEFAULT;
                }
            }
            return GAME_MODE.DEFAULT;
        }
        
        // Save game mode
        function saveGameMode(mode) {
            localStorage.setItem('gameMode', JSON.stringify(mode));
        }
        
        // Create game mode buttons
        function createGameModeButtons() {
            const gameModeOptions = document.getElementById('gameModeOptions');
            if (!gameModeOptions) return;
            
            const currentMode = getCurrentGameMode();
            
            gameModes.forEach((modeOption) => {
                const isSelected = currentMode === modeOption.id;
                
                const modeButton = document.createElement('button');
                modeButton.className = `game-mode-button pixel-button ${isSelected ? 'selected' : ''}`;
                modeButton.innerHTML = `
                    <div class="mode-name">${modeOption.name}</div>
                    <div class="mode-description">${modeOption.description}</div>
                `;
                modeButton.setAttribute('data-mode', modeOption.id);
                
                modeButton.addEventListener('click', () => {
                    saveGameMode(modeOption.id);
                    
                    // Update button states
                    document.querySelectorAll('.game-mode-button').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    modeButton.classList.add('selected');
                });
                
                gameModeOptions.appendChild(modeButton);
            });
        }
        
        // Get current paddle colors from localStorage or default
        function getCurrentPaddleColors() {
            const savedLeft = localStorage.getItem('leftPaddleColor');
            const savedRight = localStorage.getItem('rightPaddleColor');
            
            return {
                left: savedLeft ? JSON.parse(savedLeft) : DEFAULT_LEFT_PADDLE_COLOR,
                right: savedRight ? JSON.parse(savedRight) : DEFAULT_RIGHT_PADDLE_COLOR
            };
        }
        
        // Save paddle colors
        function savePaddleColors(leftColor, rightColor) {
            localStorage.setItem('leftPaddleColor', JSON.stringify(leftColor));
            localStorage.setItem('rightPaddleColor', JSON.stringify(rightColor));
        }
        
        // Check if color is selected
        function isColorSelected(color1, color2) {
            return color1[0] === color2[0] && 
                   color1[1] === color2[1] && 
                   color1[2] === color2[2];
        }
        
        // Create color buttons for a player
        function createColorButtons(gridId, currentColor, onColorSelect) {
            const colorGrid = document.getElementById(gridId);
            if (!colorGrid) return;
            
            colors.forEach((colorOption) => {
                const isSelected = isColorSelected(currentColor, colorOption.color);
                
                const colorButton = document.createElement('button');
                colorButton.className = `color-button pixel-button ${isSelected ? 'selected' : ''}`;
                colorButton.style.backgroundColor = `rgb(${colorOption.color[0]}, ${colorOption.color[1]}, ${colorOption.color[2]})`;
                colorButton.textContent = colorOption.name;
                colorButton.setAttribute('data-color', JSON.stringify(colorOption.color));
                
                colorButton.addEventListener('click', () => {
                    const newColor = colorOption.color;
                    onColorSelect(newColor);
                    
                    // Update button states in this grid
                    document.querySelectorAll(`#${gridId} .color-button`).forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    colorButton.classList.add('selected');
                });
                
                colorGrid.appendChild(colorButton);
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load player names
            const leftName = localStorage.getItem('leftPlayerName') || 'Left Player';
            const rightName = localStorage.getItem('rightPlayerName') || 'Right Player';
            
            const leftPlayerNameEl = document.getElementById('leftPlayerName');
            const rightPlayerNameEl = document.getElementById('rightPlayerName');
            if (leftPlayerNameEl) leftPlayerNameEl.textContent = leftName;
            if (rightPlayerNameEl) rightPlayerNameEl.textContent = rightName;
            
            // Load current colors
            const currentColors = getCurrentPaddleColors();
            
            // Create color buttons
            createColorButtons('leftColorGrid', currentColors.left, (color) => {
                currentColors.left = color;
                savePaddleColors(currentColors.left, currentColors.right);
            });
            
            createColorButtons('rightColorGrid', currentColors.right, (color) => {
                currentColors.right = color;
                savePaddleColors(currentColors.left, currentColors.right);
            });
            
            // Create game mode buttons
            createGameModeButtons();
            
            // Start game button
            const startGameBtn = document.getElementById('startGameBtn');
            if (startGameBtn) {
                startGameBtn.addEventListener('click', () => {
                    // Save colors
                    savePaddleColors(currentColors.left, currentColors.right);
                    // Navigate to game page
                    window.location.href = 'game.html';
                });
            }
        });
        
        // ESC key handling
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                window.location.href = 'playerNames.html';
            }
        });
    </script>
</body>
</html>

